---
description: 审查代码质量、安全性和最佳实践
argument-hint: "要审查的文件路径或范围"
allowed-tools: ["fs_read", "bash_run"]
models:
  preferred:
    - claude-sonnet-4-5
    - gpt-4-turbo
  minimum-capabilities:
    - tool-calling
---

# 代码审查工作流

本命令帮助你进行全面的代码审查，从质量、安全、性能等多个维度评估代码。

## 执行流程

### 1. 确定审查范围

根据参数确定要审查的内容：
- 单个文件
- 多个相关文件
- 特定功能模块
- 整个项目

使用 `fs_read` 读取相关代码文件。

### 2. 多维度审查

#### A. 代码质量

**可读性**
- 命名是否清晰、有意义
- 代码结构是否清晰
- 注释是否充分且有价值
- 复杂逻辑是否需要拆分

**可维护性**
- 函数和类的职责是否单一
- 代码重复度
- 模块耦合度
- 是否遵循 SOLID 原则

**一致性**
- 是否遵循项目代码规范
- 命名风格是否统一
- 错误处理是否一致
- 日志记录是否规范

#### B. 功能正确性

- 逻辑是否正确
- 边界条件处理是否完善
- 错误处理是否充分
- 是否有潜在的 bug

#### C. 性能考量

- 算法效率
- 不必要的计算或循环
- 资源管理（内存、文件句柄等）
- 数据库查询效率

#### D. 安全性

- SQL 注入风险
- XSS 漏洞
- 敏感信息泄露
- 输入验证
- 访问控制
- 加密和认证

#### E. 测试覆盖

- 是否有对应的测试
- 测试是否覆盖关键路径
- 边界条件是否测试
- 错误场景是否测试

#### F. 最佳实践

- 是否遵循语言/框架的最佳实践
- 设计模式使用是否恰当
- 依赖管理是否合理
- 错误处理模式

### 3. 生成审查报告

使用结构化格式输出审查结果：

```markdown
# 代码审查报告

## 审查对象
- 文件：[文件列表]
- 代码行数：[统计]
- 审查时间：[时间]

## 总体评价
[总体印象和关键发现]

## 详细发现

### 🔴 严重问题（必须修复）
1. **[问题类型]** [位置]
   - 问题：[描述]
   - 影响：[说明风险或影响]
   - 建议：[修复建议]

### 🟡 重要建议（强烈建议修复）
1. **[问题类型]** [位置]
   - 问题：[描述]
   - 建议：[改进建议]

### 🟢 次要建议（可选改进）
1. **[问题类型]** [位置]
   - 建议：[改进建议]
   - 收益：[说明改进的好处]

### ✨ 优点
- [值得肯定的代码实践]
- [好的设计决策]

## 具体修改建议

### 建议 #1: [标题]
**位置**: [文件名:行号]

**当前代码**:
```语言
[当前代码]
```

**问题说明**:
[详细说明问题]

**建议修改**:
```语言
[建议的代码]
```

**原因**:
[解释为什么这样改]

## 质量指标

- 代码质量：⭐⭐⭐⭐☆ (4/5)
- 安全性：⭐⭐⭐⭐⭐ (5/5)
- 性能：⭐⭐⭐☆☆ (3/5)
- 可维护性：⭐⭐⭐⭐☆ (4/5)
- 测试覆盖：⭐⭐⭐☆☆ (3/5)

## 行动清单

- [ ] [必须修复的问题1]
- [ ] [必须修复的问题2]
- [ ] [建议改进的点1]
- [ ] [建议改进的点2]

## 总结

[总结审查要点和建议的后续步骤]
```

### 4. 提供可操作的建议

- 每个问题提供具体的修复建议
- 包含代码示例
- 说明修改的原因和好处
- 排定优先级

## 使用示例

```
/review src/api/handlers.go
/review 新功能的所有代码
/review src/
```

## 审查原则

- **建设性**：提供帮助而非批评
- **具体性**：指出具体问题和改进方法
- **平衡性**：既指出问题也肯定优点
- **优先级**：区分严重问题和次要建议
- **教育性**：解释为什么，帮助提升能力

## 注意事项

- 保持客观和专业
- 基于事实和标准，避免主观偏好
- 考虑项目的实际情况和约束
- 提供替代方案而非单一答案
- 鼓励讨论和交流
