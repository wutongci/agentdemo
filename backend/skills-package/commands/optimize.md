---
description: 优化代码性能、架构或解决方案
argument-hint: "要优化的对象或优化目标"
allowed-tools: ["fs_read", "fs_write", "bash_run"]
models:
  preferred:
    - claude-sonnet-4-5
    - gpt-4-turbo
  minimum-capabilities:
    - tool-calling
scripts:
  sh: scripts/bash/check-env.sh
---

# 优化工作流

本命令帮助你识别并实施优化，提升代码性能、可维护性或资源利用率。

## 前置检查

1. 运行环境检查脚本 `{SCRIPT}`
2. 确认优化目标和约束条件

## 执行流程

### 1. 分析当前状态

#### 收集基线数据
- 使用 `fs_read` 读取相关代码
- 理解当前实现的逻辑和结构
- 识别性能瓶颈或问题点

#### 明确优化目标
- **性能优化**：减少执行时间、降低内存占用
- **代码质量**：提高可读性、可维护性
- **架构优化**：改进设计、降低耦合度
- **资源优化**：减少网络请求、数据库查询

### 2. 识别优化机会

分析以下方面的优化空间：

#### 算法和数据结构
- 时间复杂度是否可以降低
- 数据结构是否合适
- 是否有更高效的算法

#### 代码结构
- 重复代码可以提取
- 函数职责是否单一
- 是否存在不必要的计算

#### 系统设计
- 是否可以引入缓存
- 是否可以异步处理
- 是否可以批量操作

#### 资源使用
- 内存泄漏风险
- 不必要的对象创建
- 资源未及时释放

### 3. 提供优化方案

对每个优化机会提供：

```markdown
## 优化建议

### 优化点 #1: [名称]

**当前问题**
[描述当前的问题]

**优化方案**
[详细的优化方法]

**代码示例**
```语言
// 优化前
[当前代码]

// 优化后
[改进代码]
```

**预期效果**
- 性能提升：[具体数据或估计]
- 其他改进：[描述]

**实施难度**
- 难度：[低/中/高]
- 预计时间：[估算]
- 风险：[描述潜在风险]
```

### 4. 优先级排序

根据以下因素排序优化建议：
- **影响程度**：对性能或质量的提升幅度
- **实施成本**：开发和测试的工作量
- **风险评估**：引入问题的可能性
- **紧迫程度**：是否是当前瓶颈

输出优先级列表：

```markdown
## 优化优先级

### 高优先级（建议立即实施）
1. [优化点1]：[原因]
2. [优化点2]：[原因]

### 中优先级（短期规划）
1. [优化点3]：[原因]
2. [优化点4]：[原因]

### 低优先级（长期考虑）
1. [优化点5]：[原因]
```

### 5. 提供实施指导

对于高优先级的优化：
- 提供详细的重构步骤
- 说明如何验证优化效果
- 列出需要注意的测试点
- 建议回滚方案

## 使用示例

```
/optimize src/handlers/api.go
/optimize 数据库查询性能
/optimize 这个项目的整体架构
/optimize 内存使用
```

## 优化原则

- **测量先于优化**：基于数据而非猜测
- **权衡取舍**：考虑复杂度与收益的平衡
- **保持简单**：避免过早优化
- **确保正确**：优化不应改变功能
- **可验证**：有办法测量优化效果

## 注意事项

- 在优化前确保有足够的测试覆盖
- 优化应该是渐进式的，一次优化一个点
- 记录优化前后的性能对比
- 考虑代码可读性，不要牺牲太多可维护性
